var S=Object.defineProperty;var T=(n,t,i)=>t in n?S(n,t,{enumerable:!0,configurable:!0,writable:!0,value:i}):n[t]=i;var d=(n,t,i)=>(T(n,typeof t!="symbol"?t+"":t,i),i);import"./base-173ebea9.js";import{E as P}from"./el-button-c9026860.js";import{E as z}from"./el-input-0c20cd36.js";import{d as R,k as f,s as C,G as M,o as I,f as F,O as v,H as m,S as V,w as k,I as B,U as E,V as b,_ as D}from"./index-8be71128.js";import"./use-form-item-69462bdc.js";import"./index-f8748455.js";import"./index-4db4fc96.js";import"./_baseGet-5f66532d.js";const x=(n,t)=>Math.floor(Math.random()*(t-n+1)+n);class j{constructor(t,i){d(this,"x",0);d(this,"y",0);d(this,"size",0);d(this,"ctx");d(this,"conf");this.ctx=t,this.conf=i;const{width:a,height:o,particSize:[h,c]}=i;this.size=x(h*window.devicePixelRatio,c*window.devicePixelRatio);const s=Math.min(a,o)/2,e=x(0,360)*Math.PI/180,l=a/2,r=o/2;this.x=l+s*Math.cos(e),this.y=r+s*Math.sin(e)}draw(){this.ctx&&(this.ctx.beginPath(),this.ctx.arc(this.x,this.y,this.size,0,Math.PI*2),this.ctx.fillStyle=this.conf.color,this.ctx.fill())}moveTo(t,i){const o=this.x,h=this.y,c=(t-o)/300,s=(i-h)/300,e=Date.now(),l=()=>{const r=Date.now()-e,p=o+c*r,u=h+s*r;if(this.x=p,this.y=u,r>=300){this.x=t,this.y=i;return}requestAnimationFrame(l)};l()}}class _{constructor(t,i={}){d(this,"dom");d(this,"ctx");d(this,"config");d(this,"particles",[]);d(this,"canvasText","");this.dom=t,this.ctx=t==null?void 0:t.getContext("2d",{willReadFrequently:!0}),this.config={width:i.width??500,height:i.height??200,color:i.color??"#000",fontFamily:i.fontFamily??"sans-serif",fontSize:i.fontSize??120,gap:i.gap??6,particSize:i.particSize??[2,4]},this.initCanvasSize(this.config.width,this.config.height)}initCanvasSize(t,i){this.dom&&(this.dom.width=t*window.devicePixelRatio,this.dom.height=i*window.devicePixelRatio)}clear(){var t;this.dom&&((t=this.ctx)==null||t.clearRect(0,0,this.dom.width,this.dom.height))}draw(t){if(!this.dom)return;const i=typeof t=="function"?t():t;this.clear(),this.update(i);for(const a of this.particles)a.draw();typeof t=="function"&&requestAnimationFrame(()=>this.draw(t))}update(t){var l,r;if(!this.dom||!this.ctx)return;const{fontSize:i,fontFamily:a,color:o,particSize:h}=this.config;if(this.canvasText===t)return;this.canvasText=t;const c=((l=this.dom)==null?void 0:l.width)||0,s=((r=this.dom)==null?void 0:r.height)||0;this.ctx.fillStyle="#000",this.ctx.textBaseline="middle",this.ctx.textAlign="center",this.ctx.font=`${i*window.devicePixelRatio}px ${a}`,this.ctx.fillText(this.canvasText,c/2,s/2);const e=this.getPoint();this.clear(),this.particles.length>e.length&&this.particles.splice(e.length);for(let p=0;p<e.length;p++){let u=this.particles[p];u||(u=new j(this.ctx,{width:c,height:s,color:o,particSize:h}),this.particles.push(u));const[g,y]=e[p];u.moveTo(g,y)}}getPoint(){if(!this.dom||!this.ctx)return[];const{width:t,height:i}=this.dom,a=[],{data:o}=this.ctx.getImageData(0,0,t,i),{gap:h}=this.config;for(let c=0;c<t;c+=h)for(let s=0;s<i;s+=h){const e=(c+s*t)*4,[l,r,p,u]=[o[e],o[e+1],o[e+2],o[e+3]];l===0&&r===0&&p===0&&u===255&&a.push([c,s])}return a}}const w=n=>(E("data-v-13087c0d"),n=n(),b(),n),q={class:"content"},A={class:"canvasTime"},N=w(()=>m("h2",null,"粒子绘画时钟",-1)),K={class:"canvasTime"},U=w(()=>m("h2",null,"粒子绘画文字",-1)),$={class:"input"},G=R({__name:"canvasTime",setup(n){const t=f(),i=f(),a=f(),o=f(""),h=()=>{var s;(s=a.value)==null||s.draw(()=>o.value)},c=()=>new Date().toTimeString().substring(0,8);return C(()=>{new _(t.value,{width:500,height:200,fontFamily:"PCMyungjo"}).draw(c),a.value=new _(i.value,{width:500,height:200,fontFamily:"PCMyungjo"})}),(s,e)=>{const l=M("v-md-preview"),r=z,p=P;return I(),F("div",q,[v(l,{text:`
> canvas 粒子绘画
`}),m("div",A,[N,m("canvas",{ref_key:"canvasRef",ref:t},null,512)]),m("div",K,[U,m("div",$,[v(r,{modelValue:o.value,"onUpdate:modelValue":e[0]||(e[0]=u=>o.value=u),onKeyup:V(h,["enter"])},null,8,["modelValue"]),v(p,{onClick:h},{default:k(()=>[B("生成")]),_:1})]),m("canvas",{ref_key:"canvas2Ref",ref:i},null,512)])])}}});const tt=D(G,[["__scopeId","data-v-13087c0d"]]);export{tt as default};
